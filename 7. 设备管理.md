# 设备控制器
外设的种类有很多，对于多种多样的外设，使用一个硬件组件进行管理，这个组件就是设备控制器，每个I/O设备都拥有自己的设备控制器。  
设备控制器拥有自己的芯片及寄存器，可以执行自己的逻辑。其寄存器主要有3种：  
1. 状态寄存器  
标记目前的工作状态是正在进行中还是已完成。  
2. 命令寄存器  
CPU发送的指令。  
3. 数据寄存器  
CPU和I/O设备之间传输的数据。  

根据数据交换的单位，可将I/O设备分为2种：  
1. 块设备  
将数据存储在固定大小的块中，每个块有自己的地址，如U盘、硬盘等。由于块设备进行交互的数据量很大，因此设备控制器中有一个数据缓冲区，在CPU写入或读取数据时，需要等数据缓冲区囤够一定量才可进行。这样可以减少I/O设备的访问次数。CPU与设备管理器的寄存器和数据缓冲区的通信有2种方式：  
· 端口I/O，每个寄存器呗分配一个端口，通过特殊的汇编指令操作这些寄存器，如`in`和`out`等；  
· 内存映射I/O，将寄存器映射到一块内存空间中，这样就可以像操作内存一样操作寄存器；  
2. 字符设备   
字符设备是不可寻址的，以字符为单位发送或接受字符流，如鼠标。  

# I/O控制方式
1. 轮询等待  
让CPU一直查询设备状态，阴间方法。  
2. 中断  
中断分为2种：  
· 软中断  
软件上通过调用`INT`触发；  
· 硬件中断  
硬件上通过中断控制器触发；  
3. DMA  
中断仍然会消耗大量的时间，因此考虑能否让I/O设备和CPU之间的数据交换，以内存为媒介。实现这个想法需要借助DMA设备。  
CPU会向DMA设备发送指令，说明需要多少数据，并在哪里进行读取。DMA会将数据加载到内存中，一定量的数据加载完成后，才会发送中断信号。  
4. 通道  
通道也是一种专门的硬件，与DMA相似，加载完一定量数据后发出中断信号。  

# 设备驱动程序
设备控制器是硬件，不属于操作系统，而设备驱动程序是操作系统的一部分。  
操作系统可以像调用本地方法一样调用设备驱动程序中的接口，设备驱动程序是面向设备控制器的代码，可以操作设备控制器。